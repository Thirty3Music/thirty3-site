<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>THIRTY3 — Work</title>
  <meta name="description" content="THIRTY3 work: solo projects, collaborations, live/AV."/>
  <link rel="stylesheet" href="style.css"/>

  <style>
    :root{
      --muted:#b9c0c2;
      --chip:rgba(255,255,255,.06);
      --chipHover:rgba(255,255,255,.12);
      --line:rgba(255,255,255,.12);
      --bgGlass:rgba(0,0,0,.25);
      --accent:#57e2d6; /* title color */
      --ink:#e7eceb;
    }
    body.work{ overflow-y:auto; background:#000; padding-top:56px; }

    /* Hero */
    .wk-hero{ max-width:1100px; margin:48px auto 18px; padding:0 20px; }
    .wk-eyebrow{ color:var(--muted); letter-spacing:.18em; font-size:12px; margin:0 0 8px; text-transform:uppercase; opacity:.8; }
    .wk-title{ font-size:clamp(28px,3.5vw,42px); margin:0 0 10px; letter-spacing:.04em; color:var(--accent); }
    .wk-sub{ color:#dfe4e6; opacity:.85; margin:0 0 22px; line-height:1.5; }

    /* Tabs */
    .wk-tabs{
      display:flex; gap:10px; flex-wrap:wrap;
      border-top:1px solid var(--line); border-bottom:1px solid var(--line);
      padding:10px 0; margin-bottom:22px;
      background:repeating-linear-gradient(to bottom, rgba(255,255,255,.06) 0, rgba(255,255,255,.06) 1px, transparent 1px, transparent 42px);
      background-blend-mode:overlay;
    }
    .wk-tab{
      appearance:none; border:1px solid var(--line); background:var(--chip);
      color:#fff; font-size:13px; letter-spacing:.06em; font-weight:600;
      padding:8px 12px; border-radius:4px; cursor:pointer;
      transition:transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .wk-tab[aria-pressed="true"]{ background:var(--chipHover); border-color:#fff; }
    .wk-tab:hover{ transform:translateY(-1px); }

    /* Grid */
    .wk-grid{ max-width:1100px; margin:0 auto 64px; padding:0 20px; display:grid; grid-template-columns:repeat(3, 1fr); gap:16px; }
    @media (max-width:980px){ .wk-grid{ grid-template-columns:repeat(2, 1fr); } }
    @media (max-width:640px){ .wk-grid{ grid-template-columns:1fr; } }

    .wk-card{
      display:flex; flex-direction:column; gap:10px;
      background:var(--bgGlass); border:1px solid var(--line);
      border-radius:12px; overflow:hidden; cursor:pointer;
      transition:transform .14s ease, border-color .14s ease, box-shadow .14s ease;
      backdrop-filter: blur(4px);
    }
    .wk-card:hover{ transform:translateY(-2px); border-color:rgba(255,255,255,.28); box-shadow:0 10px 28px rgba(0,0,0,.35); }

    .wk-thumb{ aspect-ratio:16/10; object-fit:cover; width:100%; display:block; filter:contrast(.98) saturate(.95) brightness(.9); }
    .wk-meta{ display:flex; justify-content:space-between; align-items:center; padding:12px 14px; }
    .wk-kind{ font-size:11px; color:var(--muted); letter-spacing:.16em; text-transform:uppercase; }
    .wk-name{ font-size:15px; letter-spacing:.02em; color:var(--ink); } /* keep light */

    .wk-actions{ display:flex; gap:8px; padding:0 14px 14px; }
    .wk-chip{ border:1px solid var(--line); background:var(--chip); color:#fff; font-size:12px; padding:6px 8px; border-radius:6px; text-decoration:none; transition:background .12s ease, border-color .12s ease; }
    .wk-chip:hover{ background:var(--chipHover); border-color:#fff; }

    /* Modal */
    .wk-modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:10000; }
    .wk-modal[open]{ display:flex; }
    .wk-scrim{ position:absolute; inset:0; background:rgba(0,0,0,.55); }
    .wk-dialog{
      position:relative; z-index:1; width:min(900px, 92vw); max-height:86vh;
      background:rgba(8,10,11,.85); border:1px solid var(--line);
      border-radius:14px; overflow:hidden; box-shadow:0 24px 60px rgba(0,0,0,.5);
      display:grid; grid-template-columns:1.1fr 1fr;
    }
    @media (max-width:900px){ .wk-dialog{ grid-template-columns:1fr; } }
    .wk-preview{ background:#0b0f11; display:grid; place-items:center; min-height:280px; }
    .wk-preview img, .wk-preview video, .wk-preview iframe{ width:100%; height:100%; object-fit:cover; border:0; }
    .wk-detail{ padding:18px 18px 20px; display:flex; flex-direction:column; gap:10px; }
    .wk-detail h3{ margin:2px 0 2px; letter-spacing:.02em; color:var(--ink); }
    .wk-detail p{ margin:0; color:#dfe4e6; opacity:.86; line-height:1.5; }
    .wk-detail .wk-row{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }

    .wk-close{ position:absolute; top:10px; right:10px; border:1px solid var(--line); background:var(--chip); color:#fff; border-radius:8px; padding:6px 9px; cursor:pointer; font-size:13px; }
    .wk-close:hover{ background:var(--chipHover); border-color:#fff; }
  </style>
</head>

<body class="work">
  <header class="topbar">
    <nav>
      <a href="https://www.instagram.com/_thirty3_/" target="_blank">INSTAGRAM</a>
      <a href="https://soundcloud.com/thirty_3" target="_blank">SOUNDCLOUD</a>
      <a href="https://www.youtube.com/@thirty3473" target="_blank">YOUTUBE</a>
      <a href="work-test.html">WORK</a>
      <a href="index.html#contact">CONTACT</a>
    </nav>
  </header>

  <section class="wk-hero">
    <p class="wk-eyebrow">SELECTED</p>
    <h1 class="wk-title">Work</h1>
    <p class="wk-sub">Solo pieces, collaborations and live/visual projects.</p>

    <div class="wk-tabs" role="tablist" aria-label="Work categories">
      <button class="wk-tab" aria-pressed="true" data-filter="all">All</button>
      <button class="wk-tab" aria-pressed="false" data-filter="solo">Solo Projects</button>
      <button class="wk-tab" aria-pressed="false" data-filter="collab">Collabs</button>
      <button class="wk-tab" aria-pressed="false" data-filter="live">Live / AV</button>
    </div>
  </section>

  <section class="wk-grid" id="wkGrid" aria-live="polite"></section>

  <dialog class="wk-modal" id="wkModal">
    <div class="wk-scrim" data-close></div>
    <div class="wk-dialog">
      <div class="wk-preview" id="wkPreview"></div>
      <div class="wk-detail">
        <button class="wk-close" data-close>Close</button>
        <h3 id="wkTitle">Title</h3>
        <p id="wkDesc"></p>
        <div class="wk-row" id="wkLinks"></div>
      </div>
    </div>
  </dialog>

  <script>
/* =========================================================
   THIRTY3 — Work grid (renskrivet)
   - Manuella projekt (redigerbara nedan)
   - Auto-merge från /data/auto-projects.json (Bandcamp/SoundCloud)
   - Filter + Modal + auto-preview (YT/Vimeo/SC)
   ========================================================= */

const PLACEHOLDER = 'image00015.jpeg'; // fallback-bild i repo

/* ============ MANUELLA PROJEKT ============ */
/* kind: "solo" | "collab" | "live"
   media: { type: "image" | "video" | "embed", src: "..." }
   thumb: "auto" = försök hämta preview (YT/Vimeo/SC) via oEmbed/id  */
let PROJECTS = [
  {
    title: "11:59 — Short film",
    kind: "collab",
    thumb: "auto",
    media: { type: "embed", src: "https://player.vimeo.com/video/282178116" },
    desc: "Sound design & score. Field recordings (hometown + London).",
    links: [
      { label: "Project page", href: "https://petterscholander.com/project/1159" },
      { label: "Watch (Vimeo)", href: "https://vimeo.com/282178116" }
    ]
  },
  {
    title: "Dream, girl — Cora Onori",
    kind: "collab",
    thumb: "auto",
    media: { type: "embed", src: "https://www.youtube.com/embed/A9clscLNVi0?start=8" },
    desc: "Produced by THIRTY3. Directed by Moncef Henaien.",
    links: [
      { label: "Watch (YouTube)", href: "https://www.youtube.com/watch?v=A9clscLNVi0" },
      { label: "Listen (SoundCloud)", href: "https://soundcloud.com/coraonori/dream-girl" }
    ]
  },
  {
    title: "N I T E F I S H — Live (Nordberg)",
    kind: "live",
    thumb: "auto",
    media: { type: "embed", src: "https://www.youtube.com/embed/GDiQughTDqI" },
    desc: "Live AV: performance, virtual environment + live-manipulated audio.",
    links: [
      { label: "Watch (YouTube)", href: "https://www.youtube.com/watch?v=GDiQughTDqI" }
    ]
  },
  {
    title: "Barbie Slumlord — N I T E F I S H",
    kind: "collab",
    thumb: "auto",
    media: { type: "embed", src: "https://www.youtube.com/embed/o9cvorFHGos" },
    desc: "Produced · Mixed · Mastered by THIRTY3.",
    links: [
      { label: "Watch (YouTube)", href: "https://www.youtube.com/watch?v=o9cvorFHGos" }
    ]
  },
  {
    title: "Mitsubishi Facelift — N I T E F I S H",
    kind: "collab",
    thumb: PLACEHOLDER,
    media: { type: "image", src: PLACEHOLDER },
    desc: "Produced · Mixed · Mastered by THIRTY3.",
    links: [
      { label: "Read (Kmag article)", href: "https://kmag.se/2024/06/09/n-i-t-e-f-i-s-h-slapper-singeln-mitsubishi-facelift-fran-kommande-ep/" }
    ]
  },
  {
    title: "Permaculture Heaven — N I T E F I S H (EP)",
    kind: "collab",
    thumb: "auto",
    media: { 
      type: "embed",
      src: "https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/1742669856&visual=true"
    },
    desc: "Production (several tracks) · Mix · Master.",
    links: [
      { label: "Listen (SoundCloud playlist)", href: "https://soundcloud.com/nitefishofficial/sets/permaculture-heaven-draft-part" }
    ]
  },
  {
    title: "If I Disappear — Nightcall (ft. Thirty3)",
    kind: "collab",
    thumb: "auto",
    media: {
      type: "embed",
      src: "https://w.soundcloud.com/player/?url=https%3A//soundcloud.com/nightcallofficial/if-i-disappear&visual=true"
    },
    desc: "Feature: Thirty3.",
    links: [
      { label: "Listen (SoundCloud)", href: "https://soundcloud.com/nightcallofficial/if-i-disappear" }
    ]
  },
  {
    title: "Stuck — Nightcall (ft. Thirty3)",
    kind: "collab",
    thumb: "auto",
    media: {
      type: "embed",
      src: "https://w.soundcloud.com/player/?url=https%3A//soundcloud.com/nightcallofficial/lycka-ft-thirty3&visual=true"
    },
    desc: "Feature: Thirty3.",
    links: [
      { label: "Listen (SoundCloud)", href: "https://soundcloud.com/nightcallofficial/lycka-ft-thirty3" }
    ]
  },
  {
    title: "A short film about us and the environment",
    kind: "collab",
    thumb: "auto",
    media: { type: "embed", src: "https://player.vimeo.com/video/378989999" },
    desc: "Created by Petter Schölander. Music by Thirty3. Theme: Sokhi & Inzo.",
    links: [
      { label: "Watch (Vimeo)", href: "https://vimeo.com/378989999" }
    ]
  },
  {
    title: "Spider Plant — Mix (entire release)",
    kind: "collab",
    thumb: "auto",
    media: { 
      type: "embed", 
      src: "https://www.youtube.com/embed/7r2CZbvWSB8?list=OLAK5uy_nbkkukfRBX66iNm3pulXvNM5WEEPa6K38"
    },
    desc: "Mixing on all tracks.",
    links: [
      { label: "Listen (YouTube)", href: "https://www.youtube.com/watch?v=7r2CZbvWSB8&list=OLAK5uy_nbkkukfRBX66iNm3pulXvNM5WEEPa6K38" }
    ]
  }
];

/* ============ HJÄLPARE: auto-preview ============ */
function youtubeIdFrom(url){
  const m = url.match(/(?:embed\/|v=|youtu\.be\/)([A-Za-z0-9_-]{11})/);
  return m ? m[1] : null;
}

async function resolveThumb(p){
  if (p.thumb && p.thumb !== 'auto') return p.thumb;
  if (!p.media || p.media.type !== 'embed') return PLACEHOLDER;
  const url = p.media.src || '';

  // YouTube
  if (/youtube\.com|youtu\.be/.test(url)) {
    const id = youtubeIdFrom(url);
    if (id) return `https://img.youtube.com/vi/${id}/hqdefault.jpg`;
  }

  // Vimeo
  if (/vimeo\.com/.test(url)) {
    try {
      const vimeoUrl = url.replace('https://player.vimeo.com/video/', 'https://vimeo.com/');
      const o = await fetch(`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(vimeoUrl)}`).then(r=>r.json());
      if (o && o.thumbnail_url) return o.thumbnail_url;
    } catch(e){}
  }

  // SoundCloud
  if (/soundcloud\.com/.test(url) || /w\.soundcloud\.com\/player/.test(url)) {
    try {
      let sc = url;
      const q = new URL(url).searchParams.get('url');
      if (q) sc = decodeURIComponent(q);
      const o = await fetch(`https://soundcloud.com/oembed?format=json&url=${encodeURIComponent(sc)}`).then(r=>r.json());
      if (o && o.thumbnail_url) return o.thumbnail_url.replace('-t500x500','-t300x300');
    } catch(e){}
  }

  return PLACEHOLDER;
}

/* ============ RENDER: grid/kort ============ */
const grid = document.getElementById('wkGrid');
const tabs = [...document.querySelectorAll('.wk-tab')];
let current = 'all';

function createCard(p){
  const card = document.createElement('article');
  card.className = 'wk-card';
  card.setAttribute('tabindex','0');

  const img = document.createElement('img');
  img.className = 'wk-thumb';
  img.alt = p.title;
  img.src = PLACEHOLDER; // fallback först
  resolveThumb(p).then(u => { img.src = u || PLACEHOLDER; }).catch(()=>{});

  const meta = document.createElement('div'); 
  meta.className = 'wk-meta';
  const left = document.createElement('div');
  const kind = document.createElement('div'); kind.className = 'wk-kind'; kind.textContent = p.kind;
  const name = document.createElement('div'); name.className = 'wk-name'; name.textContent = p.title;
  left.append(kind, name);
  meta.append(left);

  const actions = document.createElement('div'); 
  actions.className = 'wk-actions';
  (p.links||[]).forEach(l=>{
    const a = document.createElement('a');
    a.href = l.href; a.target = '_blank'; a.rel='noopener';
    a.className = 'wk-chip'; a.textContent = l.label;
    actions.appendChild(a);
  });

  card.append(img, meta, actions);
  card.addEventListener('click', ()=> openModal(p));
  card.addEventListener('keydown', (e)=>{ if(e.key==='Enter') openModal(p); });

  return card;
}

function render(){
  grid.innerHTML = '';
  const list = PROJECTS.filter(p => current==='all' ? true : p.kind===current);
  list.forEach(p => grid.appendChild(createCard(p)));
}

tabs.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabs.forEach(b=>b.setAttribute('aria-pressed','false'));
    btn.setAttribute('aria-pressed','true');
    current = btn.dataset.filter;
    render();
  });
});

/* ============ MODAL ============ */
const modal = document.getElementById('wkModal');
const preview = document.getElementById('wkPreview');
const titleEl = document.getElementById('wkTitle');
const descEl = document.getElementById('wkDesc');
const linksEl = document.getElementById('wkLinks');

function openModal(p){
  titleEl.textContent = p.title;
  descEl.textContent = p.desc || '';
  linksEl.innerHTML = '';
  (p.links||[]).forEach(l=>{
    const a = document.createElement('a');
    a.href = l.href; a.target = '_blank'; a.rel='noopener';
    a.className = 'wk-chip'; a.textContent = l.label;
    linksEl.appendChild(a);
  });

  preview.innerHTML = '';
  if(p.media?.type === 'video'){
    const v = document.createElement('video');
    v.src = p.media.src; v.controls = true; v.playsInline = true;
    preview.appendChild(v);
  } else if (p.media?.type === 'embed'){
    const iframe = document.createElement('iframe');
    iframe.src = p.media.src;
    iframe.allow = "autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; web-share";
    iframe.referrerPolicy = "strict-origin-when-cross-origin";
    preview.appendChild(iframe);
  } else {
    const im = document.createElement('img');
    im.src = p.media?.src || PLACEHOLDER; im.alt = p.title;
    preview.appendChild(im);
  }

  modal.setAttribute('open','');
}
modal.addEventListener('click', (e)=>{ if(e.target.hasAttribute('data-close')) modal.removeAttribute('open'); });
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') modal.removeAttribute('open'); });

/* ============ AUTO-MERGE: /data/auto-projects.json ============ */
async function loadAutoProjects() {
  try {
    const res = await fetch('data/auto-projects.json?v=' + Date.now(), { cache: 'no-store' });
    if (!res.ok) throw new Error('No auto-projects.json yet');
    const auto = await res.json();

    // dedupe på titel (case-insensitive), behåll första förekomster
    const seen = new Set();
    function dedupe(list){
      const out = [];
      for (const p of list){
        const k = (p.title || '').trim().toLowerCase();
        if (!k || seen.has(k)) continue;
        seen.add(k);
        out.push(p);
      }
      return out;
    }

    // Låt auto-data hamna först (nyast högst), följt av dina manuella
    PROJECTS = dedupe([ ...auto, ...PROJECTS ]);
    console.log(`Auto merge OK: ${auto.length} items from /data/auto-projects.json`);
  } catch (e) {
    console.warn('Auto data not loaded:', e.message);
  }
}

/* ============ BOOT ============ */
(async function boot(){
  await loadAutoProjects();   // hämtar och merge:ar auto-data (om finns)
  render();                   // bygger griden
})();
</script>
